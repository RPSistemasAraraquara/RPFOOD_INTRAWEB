-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.bairro
(
    bai_001 integer NOT NULL,
    emp_001 integer NOT NULL,
    bai_002 character varying(60) COLLATE pg_catalog."default" NOT NULL,
    bai_003 numeric(15, 2),
    sit_001 integer NOT NULL DEFAULT 4,
    b_restricao_entrega boolean NOT NULL DEFAULT false,
    CONSTRAINT pk_bairro PRIMARY KEY (bai_001, emp_001)
);

CREATE TABLE IF NOT EXISTS public.bairro_ceps
(
    bai_001 integer NOT NULL,
    emp_001 integer NOT NULL,
    cep character varying(9) COLLATE pg_catalog."default" NOT NULL,
    logradouro character varying(125) COLLATE pg_catalog."default",
    id_cidade integer,
    cidade_desc character varying(75) COLLATE pg_catalog."default",
    uf_sigla character varying(2) COLLATE pg_catalog."default",
    CONSTRAINT pk_bairro_ceps PRIMARY KEY (bai_001, emp_001, cep)
);

CREATE TABLE IF NOT EXISTS public.clientes
(
    id_empresa integer NOT NULL DEFAULT 1,
    cli_004 character varying(20) COLLATE pg_catalog."default",
    sit_001 integer NOT NULL DEFAULT 4,
    observacao text COLLATE pg_catalog."default",
    senha_email character varying(100) COLLATE pg_catalog."default",
    pontos_atuais integer,
    email character varying(100) COLLATE pg_catalog."default",
    tipo_pessoa character varying(1) COLLATE pg_catalog."default" DEFAULT 'F'::character varying,
    celular1 character varying(30) COLLATE pg_catalog."default",
    cli_001 integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    cli_012 character varying(50) COLLATE pg_catalog."default",
    cli_002 character varying(100) COLLATE pg_catalog."default"
);

CREATE TABLE IF NOT EXISTS public.clientes_endereco
(
    id_endereco integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    cli_001 integer NOT NULL,
    id_empresa integer NOT NULL,
    cep_002 character varying(9) COLLATE pg_catalog."default",
    cep_003 character varying(50) COLLATE pg_catalog."default",
    cep_004 character varying(125) COLLATE pg_catalog."default",
    cli_007 character varying(80) COLLATE pg_catalog."default",
    cli_008 character varying(100) COLLATE pg_catalog."default",
    cli_009 character varying(100) COLLATE pg_catalog."default",
    bai_001 integer,
    endereco_padrao boolean DEFAULT false,
    taxa numeric(15, 3),
    CONSTRAINT pk_clientes_endereco PRIMARY KEY (id_endereco, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.configuracao_funcionamento
(
    dia_segunda boolean NOT NULL DEFAULT false,
    dia_terca boolean NOT NULL DEFAULT false,
    dia_quarta boolean NOT NULL DEFAULT false,
    dia_quinta boolean NOT NULL DEFAULT false,
    dia_sexta boolean NOT NULL DEFAULT false,
    dia_sabado boolean NOT NULL DEFAULT false,
    dia_domingo boolean NOT NULL DEFAULT false,
    segunda_inicio_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    terca_inicio_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    quarta_inicio_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    quinta_inicio_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    sexta_inicio_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    sabado_inicio_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    domingo_inicio_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    segunda_fim_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    terca_fim_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    quarta_fim_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    quinta_fim_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    sexta_fim_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    sabado_fim_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    domingo_fim_atendimento time without time zone NOT NULL DEFAULT '00:00:00'::time without time zone,
    id_empresa integer NOT NULL,
    id serial NOT NULL,
    CONSTRAINT configuracao_funcionamento_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.configuracao_rpfood
(
    id_empresa integer NOT NULL DEFAULT 1,
    nao_utilizar_ceps boolean NOT NULL DEFAULT false,
    tempo_retirada_rpfood integer NOT NULL DEFAULT 0,
    tempo_entrega_rpfood integer NOT NULL DEFAULT 0,
    utiliza_tipo_entrega_retirada boolean DEFAULT true,
    modo_acougue boolean NOT NULL DEFAULT false,
    pedido_minimo numeric(15, 2) NOT NULL DEFAULT 0.00,
    id serial NOT NULL,
    utiliza_controle_opcionais boolean DEFAULT false,
    CONSTRAINT configuracao_rpfood_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.empresas
(
    descricao character varying(40) COLLATE pg_catalog."default",
    codiuf integer,
    codicidade integer,
    uf character varying(2) COLLATE pg_catalog."default",
    cidade character varying(30) COLLATE pg_catalog."default",
    bairro character varying(30) COLLATE pg_catalog."default",
    endereco character varying(60) COLLATE pg_catalog."default",
    tipoendereco character varying(30) COLLATE pg_catalog."default",
    nome character varying(60) COLLATE pg_catalog."default",
    razsoc character varying(60) COLLATE pg_catalog."default",
    cnpj character varying(18) COLLATE pg_catalog."default",
    cep character varying(20) COLLATE pg_catalog."default",
    numero character varying(20) COLLATE pg_catalog."default",
    fone1 character varying(30) COLLATE pg_catalog."default",
    descrifone1 character varying(20) COLLATE pg_catalog."default",
    ddd1 character(3) COLLATE pg_catalog."default",
    email character varying(100) COLLATE pg_catalog."default",
    site character varying(100) COLLATE pg_catalog."default",
    complemento character varying(100) COLLATE pg_catalog."default",
    id_situacao integer NOT NULL DEFAULT 4,
    inscricao_estadual character varying(18) COLLATE pg_catalog."default",
    id_empresa integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    CONSTRAINT empresas_pkey PRIMARY KEY (id_empresa)
);

CREATE TABLE IF NOT EXISTS public.formapgto
(
    id integer NOT NULL,
    id_empresa integer NOT NULL,
    descricao character varying(50) COLLATE pg_catalog."default",
    id_situacao integer,
    b_venda_web boolean DEFAULT false,
    sfi_codigo integer,
    CONSTRAINT formapgto_pkey PRIMARY KEY (id, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.grupos
(
    codigo integer NOT NULL,
    descricao character varying(60) COLLATE pg_catalog."default",
    img bytea,
    id_situacao integer NOT NULL DEFAULT 4,
    id_empresa integer NOT NULL,
    b_exibir_web boolean NOT NULL DEFAULT false,
    CONSTRAINT grupos_pkey PRIMARY KEY (codigo, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.happy_hour
(
    id serial NOT NULL,
    idproduto integer NOT NULL,
    idempresa integer NOT NULL,
    horainicial time without time zone NOT NULL,
    horafinal time without time zone NOT NULL,
    segundafeira boolean NOT NULL,
    tercafeira boolean NOT NULL,
    quartafeira boolean NOT NULL,
    quintafeira boolean NOT NULL,
    sextafeira boolean NOT NULL,
    sabado boolean NOT NULL,
    domingo boolean NOT NULL,
    valor numeric(15, 3) NOT NULL,
    utiliza_mesa boolean DEFAULT false,
    utiliza_delivery boolean DEFAULT false,
    CONSTRAINT happy_hour_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.mesa
(
    mes_001 integer,
    emp_001 integer,
    mes_002 character varying(30) COLLATE pg_catalog."default",
    mes_003 integer,
    id_situacao integer DEFAULT 4
);

CREATE TABLE IF NOT EXISTS public.opcional
(
    codigo integer NOT NULL,
    id_empresa integer NOT NULL,
    descricao character varying(100) COLLATE pg_catalog."default" NOT NULL,
    valor numeric(15, 2) NOT NULL,
    id_situacao integer NOT NULL DEFAULT 4,
    opc_p character varying(100) COLLATE pg_catalog."default",
    opc_m character varying(100) COLLATE pg_catalog."default",
    opc_g character varying(100) COLLATE pg_catalog."default",
    opc_extra character varying(100) COLLATE pg_catalog."default",
    valor_opc_p numeric(15, 2) DEFAULT 0.00,
    valor_opc_g numeric(15, 2) DEFAULT 0.00,
    valor_opc_m numeric(15, 2) DEFAULT 0.00,
    valor_opc_gg numeric(15, 2) DEFAULT 0.00,
    valor_opc_extra numeric(15, 2) DEFAULT 0.00,
    tipo integer NOT NULL DEFAULT 0,
    opc_gg character varying(100) COLLATE pg_catalog."default",
    imagem_db bytea,
    CONSTRAINT opcional_pkey PRIMARY KEY (codigo, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.produtos
(
    codigo integer NOT NULL,
    descricao character varying(60) COLLATE pg_catalog."default",
    codigrupo integer,
    valfinal numeric(15, 2),
    valcompra numeric(15, 2),
    observacao character varying(1200) COLLATE pg_catalog."default",
    img1 bytea,
    img2 bytea,
    img bytea,
    id_situacao integer NOT NULL DEFAULT 4,
    id_empresa integer NOT NULL,
    b_venda_web boolean NOT NULL DEFAULT false,
    utiliza_combo boolean NOT NULL DEFAULT false,
    b_destaque_web boolean DEFAULT false,
    b_permite_frac boolean NOT NULL DEFAULT true,
    tamanho_p character varying(100) COLLATE pg_catalog."default",
    tamanho_m character varying(100) COLLATE pg_catalog."default",
    tamanho_g character varying(100) COLLATE pg_catalog."default",
    tamanho_gg character varying(100) COLLATE pg_catalog."default",
    tamanho_extra character varying(100) COLLATE pg_catalog."default",
    tamanho_padrao character varying(2) COLLATE pg_catalog."default" DEFAULT 'M'::character varying,
    valor_tam_p numeric(15, 2) DEFAULT 0.00,
    valor_tam_m numeric(15, 2) DEFAULT 0.00,
    valor_tam_g numeric(15, 2) DEFAULT 0.00,
    valor_tam_gg numeric(15, 2) DEFAULT 0.00,
    b_venda_tamanho boolean DEFAULT false,
    valor_tam_extra numeric(15, 2) DEFAULT 0.00,
    b_carrossel boolean DEFAULT false,
    utiliza_promocao boolean DEFAULT false,
    b_exporta_peso_balanca boolean DEFAULT false,
    b_peso_balanca boolean NOT NULL DEFAULT false,
    restringirvenda boolean DEFAULT false,
    utiliza_happy_hour boolean DEFAULT false,
    opcional_minimo integer DEFAULT 0,
    opcional_maximo integer DEFAULT 0,
    CONSTRAINT produtos_pkey PRIMARY KEY (codigo, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.produtos_opcional
(
    id_empresa integer NOT NULL,
    id_material integer NOT NULL,
    id_opcional integer NOT NULL
);

CREATE TABLE IF NOT EXISTS public.promocao
(
    id_promocao integer NOT NULL,
    id_empresa integer NOT NULL,
    id_material integer NOT NULL,
    tipo_desconto integer NOT NULL DEFAULT 0,
    segundafeira boolean NOT NULL DEFAULT false,
    tercafeira boolean NOT NULL DEFAULT false,
    quartafeira boolean NOT NULL DEFAULT false,
    quintafeira boolean NOT NULL DEFAULT false,
    sextafeira boolean NOT NULL DEFAULT false,
    sabado boolean NOT NULL DEFAULT false,
    domingo boolean NOT NULL DEFAULT false,
    tipomesa boolean NOT NULL DEFAULT false,
    tipodelivery boolean NOT NULL DEFAULT false,
    tipocomanda boolean NOT NULL DEFAULT false,
    descontosegundapadrao numeric(15, 3) DEFAULT 0,
    descontosegundatamanhop numeric(15, 3) DEFAULT 0,
    descontosegundatamanhom numeric(15, 3) DEFAULT 0,
    descontosegundatamanhog numeric(15, 3) DEFAULT 0,
    descontosegundatamanhogg numeric(15, 3) DEFAULT 0,
    descontosegundatamanhoextra numeric(15, 3) DEFAULT 0,
    desconto_ter_padrao numeric(15, 3) DEFAULT 0,
    desconto_ter_tam_p numeric(15, 3) DEFAULT 0,
    desconto_ter_tam_m numeric(15, 3) DEFAULT 0,
    desconto_ter_tam_g numeric(15, 3) DEFAULT 0,
    desconto_ter_tam_gg numeric(15, 3) DEFAULT 0,
    desconto_ter_tam_extra numeric(15, 3) DEFAULT 0,
    desconto_qua_padrao numeric(15, 3) DEFAULT 0,
    desconto_qua_tam_p numeric(15, 3) DEFAULT 0,
    desconto_qua_tam_m numeric(15, 3) DEFAULT 0,
    desconto_qua_tam_g numeric(15, 3) DEFAULT 0,
    desconto_qua_tam_gg numeric(15, 3) DEFAULT 0,
    desconto_qua_tam_extra numeric(15, 3) DEFAULT 0,
    desconto_qui_padrao numeric(15, 3) DEFAULT 0,
    desconto_qui_tam_p numeric(15, 3) DEFAULT 0,
    desconto_qui_tam_m numeric(15, 3) DEFAULT 0,
    desconto_qui_tam_g numeric(15, 3) DEFAULT 0,
    desconto_qui_tam_gg numeric(15, 3) DEFAULT 0,
    desconto_qui_tam_extra numeric(15, 3) DEFAULT 0,
    desconto_sex_padrao numeric(15, 3) DEFAULT 0,
    desconto_sex_tam_p numeric(15, 3) DEFAULT 0,
    desconto_sex_tam_m numeric(15, 3) DEFAULT 0,
    desconto_sex_tam_g numeric(15, 3) DEFAULT 0,
    desconto_sex_tam_gg numeric(15, 3) DEFAULT 0,
    desconto_sex_tam_extra numeric(15, 3) DEFAULT 0,
    desconto_sab_padrao numeric(15, 3) DEFAULT 0,
    desconto_sab_tam_p numeric(15, 3) DEFAULT 0,
    desconto_sab_tam_m numeric(15, 3) DEFAULT 0,
    desconto_sab_tam_g numeric(15, 3) DEFAULT 0,
    desconto_sab_tam_gg numeric(15, 3) DEFAULT 0,
    desconto_sab_tam_extra numeric(15, 3) DEFAULT 0,
    desconto_dom_padrao numeric(15, 3) DEFAULT 0,
    desconto_dom_tam_p numeric(15, 3) DEFAULT 0,
    desconto_dom_tam_m numeric(15, 3) DEFAULT 0,
    desconto_dom_tam_g numeric(15, 3) DEFAULT 0,
    desconto_dom_tam_gg numeric(15, 3) DEFAULT 0,
    desconto_dom_tam_extra numeric(15, 3) DEFAULT 0,
    CONSTRAINT pk_promocao PRIMARY KEY (id_promocao, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.restricoesvendas
(
    idempresa integer,
    idproduto integer,
    segundafeira boolean DEFAULT false,
    tercafeira boolean DEFAULT false,
    quartafeira boolean DEFAULT false,
    quintafeira boolean DEFAULT false,
    sextafeira boolean DEFAULT false,
    sabado boolean DEFAULT false,
    domingo boolean DEFAULT false
);

CREATE TABLE IF NOT EXISTS public.sincronizacao
(
    id integer NOT NULL,
    data timestamp without time zone NOT NULL,
    id_empresa integer NOT NULL
);

COMMENT ON COLUMN public.sincronizacao.id
    IS 'ID de sincronizacao';

COMMENT ON COLUMN public.sincronizacao.data
    IS 'Data da sincronizacao';

COMMENT ON COLUMN public.sincronizacao.id_empresa
    IS 'ID da empresa';

CREATE TABLE IF NOT EXISTS public.transferencia_imagens
(
    id serial NOT NULL,
    tipo character varying(10) COLLATE pg_catalog."default" NOT NULL,
    id_empresa integer NOT NULL DEFAULT 1,
    id_registro integer NOT NULL
);

CREATE TABLE IF NOT EXISTS public.usuarios
(
    codigo integer NOT NULL,
    nome character varying(30) COLLATE pg_catalog."default",
    senha character varying(60) COLLATE pg_catalog."default",
    email character varying(100) COLLATE pg_catalog."default",
    id_situacao integer NOT NULL DEFAULT 4,
    CONSTRAINT pk_usuarios PRIMARY KEY (codigo)
);

CREATE TABLE IF NOT EXISTS public.usuarios_empresa
(
    codigo_usuario integer NOT NULL,
    id_empresa integer NOT NULL,
    CONSTRAINT pk_usuarios_empresa PRIMARY KEY (codigo_usuario, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.usuarios_permissoes
(
    codigo_usuario integer NOT NULL,
    b_acesso_web boolean DEFAULT false,
    b_admin_web boolean DEFAULT false,
    id_empresa integer NOT NULL DEFAULT 1
);

CREATE TABLE IF NOT EXISTS public.venda
(
    id_venda integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    id_empresa integer NOT NULL,
    id_situacao integer NOT NULL,
    id_formapgto integer NOT NULL,
    id_cliente integer NOT NULL,
    totals_products numeric(15, 2),
    sub_total numeric(15, 2),
    taxa_entrega numeric(15, 2),
    troco numeric(15, 2),
    valor_receber numeric(15, 2),
    sales numeric(15, 2),
    data_pedido timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    b_recebido_lecheff boolean NOT NULL DEFAULT false,
    tipo_entrega character varying(2) COLLATE pg_catalog."default" NOT NULL DEFAULT 'D'::character varying,
    observacao character varying(200) COLLATE pg_catalog."default",
    CONSTRAINT pk_venda PRIMARY KEY (id_venda, id_empresa)
);

CREATE TABLE IF NOT EXISTS public.venda_endereco
(
    id_venda integer NOT NULL,
    id_cliente integer NOT NULL,
    id_bairro integer,
    cep character varying(14) COLLATE pg_catalog."default" NOT NULL,
    logradouro character varying(150) COLLATE pg_catalog."default" NOT NULL,
    numero character varying(30) COLLATE pg_catalog."default",
    complemento character varying(150) COLLATE pg_catalog."default",
    ponto_referencia character varying(150) COLLATE pg_catalog."default",
    bairro_desc character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT venda_endereco_pkey PRIMARY KEY (id_venda, id_cliente)
);

CREATE TABLE IF NOT EXISTS public.vendaitem
(
    id_venda integer NOT NULL,
    id_empresa integer NOT NULL,
    id_product integer NOT NULL,
    numero_item integer NOT NULL,
    quantidade numeric(15, 4) NOT NULL DEFAULT 0,
    valor_unit_product numeric(15, 4) NOT NULL DEFAULT 0,
    totals_products numeric(15, 4) NOT NULL DEFAULT 0,
    id_situacao integer,
    tamanho character varying(40) COLLATE pg_catalog."default",
    b_venda_tamanho boolean DEFAULT false,
    item_fracionado integer,
    observacao character varying(150) COLLATE pg_catalog."default",
    utilizou_happy_hour boolean DEFAULT false,
    CONSTRAINT pk_vendaitem PRIMARY KEY (id_venda, id_empresa, numero_item)
);

CREATE TABLE IF NOT EXISTS public.vendaitemopcional
(
    id_venda integer NOT NULL,
    id_empresa integer NOT NULL,
    id_numero_item integer NOT NULL,
    id_opcional integer NOT NULL,
    gratis numeric(15, 4) NOT NULL DEFAULT 0,
    valor numeric(15, 4) NOT NULL DEFAULT 0,
    valorunitario numeric(15, 4) NOT NULL DEFAULT 0,
    valortotal numeric(15, 4) NOT NULL DEFAULT 0,
    quantidade numeric(15, 4) NOT NULL DEFAULT 0,
    quantidade_replicar numeric(15, 4) NOT NULL DEFAULT 0
);

CREATE TABLE IF NOT EXISTS public.vendamesa
(
    id_venda integer,
    id_empresa integer,
    id_situacao integer,
    totals_products numeric(15, 3),
    sub_total numeric(15, 3),
    sales numeric(15, 3),
    data_pedido timestamp without time zone,
    b_recebido_lecheff boolean DEFAULT false,
    observacao character varying(300) COLLATE pg_catalog."default",
    numero_mesa integer,
    descricao_mesa character varying(20) COLLATE pg_catalog."default"
);

CREATE TABLE IF NOT EXISTS public.vendamesaitem
(
    id_venda integer NOT NULL,
    id_empresa integer NOT NULL,
    id_product integer NOT NULL,
    numero_item integer NOT NULL,
    quantidade numeric(15, 4) NOT NULL DEFAULT 0,
    valor_unit_product numeric(15, 4) NOT NULL DEFAULT 0,
    totals_products numeric(15, 4) NOT NULL DEFAULT 0,
    id_situacao integer,
    tamanho character varying(2) COLLATE pg_catalog."default",
    b_venda_tamanho boolean DEFAULT false,
    item_fracionado integer,
    observacao character varying(150) COLLATE pg_catalog."default",
    b_recebido_lecheff boolean DEFAULT false,
    utilizou_happy_hour boolean DEFAULT false,
    utilizou_promocao boolean DEFAULT false,
    CONSTRAINT pk_vendamesaitem PRIMARY KEY (id_venda, id_empresa, numero_item)
);

CREATE TABLE IF NOT EXISTS public.vendas_status_log
(
    id_venda integer NOT NULL,
    id_empresa integer NOT NULL DEFAULT 1,
    id_situacao integer NOT NULL,
    data timestamp without time zone,
    CONSTRAINT pk_vendas_status_log PRIMARY KEY (id_venda, id_empresa, id_situacao)
);

ALTER TABLE IF EXISTS public.bairro_ceps
    ADD CONSTRAINT fk_bairro_ceps FOREIGN KEY (bai_001, emp_001)
    REFERENCES public.bairro (bai_001, emp_001) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.formapgto
    ADD CONSTRAINT fk_formapgto_id FOREIGN KEY (id_empresa)
    REFERENCES public.empresas (id_empresa) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.promocao
    ADD CONSTRAINT fk_promocao_idmaterial FOREIGN KEY (id_material, id_empresa)
    REFERENCES public.produtos (codigo, id_empresa) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.vendaitem
    ADD CONSTRAINT fk_venda_item_empresa FOREIGN KEY (id_empresa)
    REFERENCES public.empresas (id_empresa) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

END;



-- FUNCTION: public.is_atendimento_disponivel()

-- DROP FUNCTION IF EXISTS public.is_atendimento_disponivel();

CREATE OR REPLACE FUNCTION public.is_atendimento_disponivel(
	)
    RETURNS boolean
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
AS $BODY$

DECLARE
    atendimento_disponivel BOOLEAN := false;
    config configuracao_funcionamento%ROWTYPE;
    current_day_of_week INTEGER;
    current_local_time TIME;
BEGIN
    -- Obter o dia da semana atual (0 para domingo, 1 para segunda-feira, 2 para terça-feira, etc.)
    current_day_of_week := EXTRACT(DOW FROM CURRENT_DATE)::INTEGER;

    -- Obter o horário atual em 'America/Sao_Paulo'
    current_local_time := (SELECT Current_Time at time zone 'America/Sao_Paulo');

    -- Obter as configurações de atendimento
    SELECT * INTO config FROM configuracao_funcionamento LIMIT 1;

    -- Verificar se o atendimento está disponível no dia da semana atual
    CASE current_day_of_week
        WHEN 1 THEN
            atendimento_disponivel := config.dia_segunda AND
                current_local_time >= config.segunda_inicio_atendimento AND
                current_local_time <= config.segunda_fim_atendimento;
        WHEN 2 THEN
            atendimento_disponivel := config.dia_terca AND
                current_local_time >= config.terca_inicio_atendimento AND
                current_local_time <= config.terca_fim_atendimento;
        WHEN 3 THEN
            atendimento_disponivel := config.dia_quarta AND
                current_local_time >= config.quarta_inicio_atendimento AND
                current_local_time <= config.quarta_fim_atendimento;
        WHEN 4 THEN
            atendimento_disponivel := config.dia_quinta AND
                current_local_time >= config.quinta_inicio_atendimento AND
                current_local_time <= config.quinta_fim_atendimento;
        WHEN 5 THEN
            atendimento_disponivel := config.dia_sexta AND
                current_local_time >= config.sexta_inicio_atendimento AND
                current_local_time <= config.sexta_fim_atendimento;
        WHEN 6 THEN
            atendimento_disponivel := config.dia_sabado AND
                current_local_time >= config.sabado_inicio_atendimento AND
                current_local_time <= config.sabado_fim_atendimento;
        WHEN 0 THEN
            atendimento_disponivel := config.dia_domingo AND
                current_local_time >= config.domingo_inicio_atendimento AND
                current_local_time <= config.domingo_fim_atendimento;
    END CASE;

    RETURN atendimento_disponivel;
END;
$BODY$;

ALTER FUNCTION public.is_atendimento_disponivel()
    OWNER TO postgres;
	
	
	
	
	
	ALTER TABLE produtos
ALTER COLUMN observacao TYPE varchar(1200);




ALTER TABLE vendaitem 
ALTER COLUMN tamanho TYPE varchar(40);
