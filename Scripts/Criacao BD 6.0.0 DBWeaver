-- DROP SCHEMA public;

CREATE SCHEMA public AUTHORIZATION pg_database_owner;

COMMENT ON SCHEMA public IS 'standard public schema';

-- DROP SEQUENCE public.clientes_cli_001_seq;

CREATE SEQUENCE public.clientes_cli_001_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;
-- DROP SEQUENCE public.clientes_endereco_id_endereco_seq;

CREATE SEQUENCE public.clientes_endereco_id_endereco_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;
-- DROP SEQUENCE public.configuracao_funcionamento_id_seq;

CREATE SEQUENCE public.configuracao_funcionamento_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;
-- DROP SEQUENCE public.configuracao_rpfood_id_seq;

CREATE SEQUENCE public.configuracao_rpfood_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;
-- DROP SEQUENCE public.empresas_id_empresa_seq;

CREATE SEQUENCE public.empresas_id_empresa_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;
-- DROP SEQUENCE public.happy_hour_id_seq;

CREATE SEQUENCE public.happy_hour_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;
-- DROP SEQUENCE public.transferencia_imagens_id_seq;

CREATE SEQUENCE public.transferencia_imagens_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;
-- DROP SEQUENCE public.venda_id_venda_seq;

CREATE SEQUENCE public.venda_id_venda_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;-- public.bairro definição

-- Drop table

-- DROP TABLE public.bairro;

CREATE TABLE public.bairro (
	bai_001 int4 NOT NULL,
	emp_001 int4 NOT NULL,
	bai_002 varchar(60) NOT NULL,
	bai_003 numeric(15, 2) NULL,
	sit_001 int4 DEFAULT 4 NOT NULL,
	b_restricao_entrega bool DEFAULT false NOT NULL,
	CONSTRAINT pk_bairro PRIMARY KEY (bai_001, emp_001)
);


-- public.clientes definição

-- Drop table

-- DROP TABLE public.clientes;

CREATE TABLE public.clientes (
	id_empresa int4 DEFAULT 1 NOT NULL,
	cli_004 varchar(20) NULL,
	sit_001 int4 DEFAULT 4 NOT NULL,
	observacao text NULL,
	senha_email varchar(100) NULL,
	pontos_atuais int4 NULL,
	email varchar(100) NULL,
	tipo_pessoa varchar(1) DEFAULT 'F'::character varying NULL,
	celular1 varchar(30) NULL,
	cli_001 int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	cli_012 varchar(50) NULL,
	cli_002 varchar(100) NULL
);


-- public.clientes_endereco definição

-- Drop table

-- DROP TABLE public.clientes_endereco;

CREATE TABLE public.clientes_endereco (
	id_endereco int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	cli_001 int4 NOT NULL,
	id_empresa int4 NOT NULL,
	cep_002 varchar(9) NULL,
	cep_003 varchar(50) NULL,
	cep_004 varchar(125) NULL,
	cli_007 varchar(80) NULL,
	cli_008 varchar(100) NULL,
	cli_009 varchar(100) NULL,
	bai_001 int4 NULL,
	endereco_padrao bool DEFAULT false NULL,
	taxa numeric(15, 3) NULL,
	CONSTRAINT pk_clientes_endereco PRIMARY KEY (id_endereco, id_empresa)
);


-- public.configuracao_funcionamento definição

-- Drop table

-- DROP TABLE public.configuracao_funcionamento;

CREATE TABLE public.configuracao_funcionamento (
	dia_segunda bool DEFAULT false NOT NULL,
	dia_terca bool DEFAULT false NOT NULL,
	dia_quarta bool DEFAULT false NOT NULL,
	dia_quinta bool DEFAULT false NOT NULL,
	dia_sexta bool DEFAULT false NOT NULL,
	dia_sabado bool DEFAULT false NOT NULL,
	dia_domingo bool DEFAULT false NOT NULL,
	segunda_inicio_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	terca_inicio_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	quarta_inicio_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	quinta_inicio_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	sexta_inicio_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	sabado_inicio_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	domingo_inicio_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	segunda_fim_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	terca_fim_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	quarta_fim_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	quinta_fim_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	sexta_fim_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	sabado_fim_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	domingo_fim_atendimento time DEFAULT '00:00:00'::time without time zone NOT NULL,
	id_empresa int4 NOT NULL,
	id serial4 NOT NULL,
	CONSTRAINT configuracao_funcionamento_pkey PRIMARY KEY (id)
);


-- public.configuracao_rpfood definição

-- Drop table

-- DROP TABLE public.configuracao_rpfood;

CREATE TABLE public.configuracao_rpfood (
	id_empresa int4 DEFAULT 1 NOT NULL,
	nao_utilizar_ceps bool DEFAULT false NOT NULL,
	tempo_retirada_rpfood int4 DEFAULT 0 NOT NULL,
	tempo_entrega_rpfood int4 DEFAULT 0 NOT NULL,
	utiliza_tipo_entrega_retirada bool DEFAULT true NULL,
	modo_acougue bool DEFAULT false NOT NULL,
	pedido_minimo numeric(15, 2) DEFAULT 0.00 NOT NULL,
	id serial4 NOT NULL,
	utiliza_controle_opcionais bool DEFAULT false NULL,
	CONSTRAINT configuracao_rpfood_pkey PRIMARY KEY (id)
);


-- public.empresas definição

-- Drop table

-- DROP TABLE public.empresas;

CREATE TABLE public.empresas (
	descricao varchar(40) NULL,
	codiuf int4 NULL,
	codicidade int4 NULL,
	uf varchar(2) NULL,
	cidade varchar(30) NULL,
	bairro varchar(30) NULL,
	endereco varchar(60) NULL,
	tipoendereco varchar(30) NULL,
	nome varchar(60) NULL,
	razsoc varchar(60) NULL,
	cnpj varchar(18) NULL,
	cep varchar(20) NULL,
	numero varchar(20) NULL,
	fone1 varchar(30) NULL,
	descrifone1 varchar(20) NULL,
	ddd1 bpchar(3) NULL,
	email varchar(100) NULL,
	site varchar(100) NULL,
	complemento varchar(100) NULL,
	id_situacao int4 DEFAULT 4 NOT NULL,
	inscricao_estadual varchar(18) NULL,
	id_empresa int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	CONSTRAINT empresas_pkey PRIMARY KEY (id_empresa)
);


-- public.grupos definição

-- Drop table

-- DROP TABLE public.grupos;

CREATE TABLE public.grupos (
	codigo int4 NOT NULL,
	descricao varchar(60) NULL,
	img bytea NULL,
	id_situacao int4 DEFAULT 4 NOT NULL,
	id_empresa int4 NOT NULL,
	b_exibir_web bool DEFAULT false NOT NULL,
	CONSTRAINT grupos_pkey PRIMARY KEY (codigo, id_empresa)
);


-- public.happy_hour definição

-- Drop table

-- DROP TABLE public.happy_hour;

CREATE TABLE public.happy_hour (
	id serial4 NOT NULL,
	idproduto int4 NOT NULL,
	idempresa int4 NOT NULL,
	horainicial time NOT NULL,
	horafinal time NOT NULL,
	segundafeira bool NOT NULL,
	tercafeira bool NOT NULL,
	quartafeira bool NOT NULL,
	quintafeira bool NOT NULL,
	sextafeira bool NOT NULL,
	sabado bool NOT NULL,
	domingo bool NOT NULL,
	valor numeric(15, 3) NOT NULL,
	utiliza_mesa bool DEFAULT false NULL,
	utiliza_delivery bool DEFAULT false NULL,
	CONSTRAINT happy_hour_pkey PRIMARY KEY (id)
);


-- public.mesa definição

-- Drop table

-- DROP TABLE public.mesa;

CREATE TABLE public.mesa (
	mes_001 int4 NULL,
	emp_001 int4 NULL,
	mes_002 varchar(30) NULL,
	mes_003 int4 NULL,
	id_situacao int4 DEFAULT 4 NULL
);


-- public.opcional definição

-- Drop table

-- DROP TABLE public.opcional;

CREATE TABLE public.opcional (
	codigo int4 NOT NULL,
	id_empresa int4 NOT NULL,
	descricao varchar(100) NOT NULL,
	valor numeric(15, 2) NOT NULL,
	id_situacao int4 DEFAULT 4 NOT NULL,
	opc_p varchar(100) NULL,
	opc_m varchar(100) NULL,
	opc_g varchar(100) NULL,
	opc_extra varchar(100) NULL,
	valor_opc_p numeric(15, 2) DEFAULT 0.00 NULL,
	valor_opc_g numeric(15, 2) DEFAULT 0.00 NULL,
	valor_opc_m numeric(15, 2) DEFAULT 0.00 NULL,
	valor_opc_gg numeric(15, 2) DEFAULT 0.00 NULL,
	valor_opc_extra numeric(15, 2) DEFAULT 0.00 NULL,
	tipo int4 DEFAULT 0 NOT NULL,
	opc_gg varchar(100) NULL,
	imagem_db bytea NULL,
	CONSTRAINT opcional_pkey PRIMARY KEY (codigo, id_empresa)
);


-- public.produtos definição

-- Drop table

-- DROP TABLE public.produtos;

CREATE TABLE public.produtos (
	codigo int4 NOT NULL,
	descricao varchar(60) NULL,
	codigrupo int4 NULL,
	valfinal numeric(15, 2) NULL,
	valcompra numeric(15, 2) NULL,
	observacao varchar(1200) NULL,
	img1 bytea NULL,
	img2 bytea NULL,
	img bytea NULL,
	id_situacao int4 DEFAULT 4 NOT NULL,
	id_empresa int4 NOT NULL,
	b_venda_web bool DEFAULT false NOT NULL,
	utiliza_combo bool DEFAULT false NOT NULL,
	b_destaque_web bool DEFAULT false NULL,
	b_permite_frac bool DEFAULT true NOT NULL,
	tamanho_p varchar(100) NULL,
	tamanho_m varchar(100) NULL,
	tamanho_g varchar(100) NULL,
	tamanho_gg varchar(100) NULL,
	tamanho_extra varchar(100) NULL,
	tamanho_padrao varchar(2) DEFAULT 'M'::character varying NULL,
	valor_tam_p numeric(15, 2) DEFAULT 0.00 NULL,
	valor_tam_m numeric(15, 2) DEFAULT 0.00 NULL,
	valor_tam_g numeric(15, 2) DEFAULT 0.00 NULL,
	valor_tam_gg numeric(15, 2) DEFAULT 0.00 NULL,
	b_venda_tamanho bool DEFAULT false NULL,
	valor_tam_extra numeric(15, 2) DEFAULT 0.00 NULL,
	b_carrossel bool DEFAULT false NULL,
	utiliza_promocao bool DEFAULT false NULL,
	b_exporta_peso_balanca bool DEFAULT false NULL,
	b_peso_balanca bool DEFAULT false NOT NULL,
	restringirvenda bool DEFAULT false NULL,
	utiliza_happy_hour bool DEFAULT false NULL,
	opcional_minimo int4 DEFAULT 0 NULL,
	opcional_maximo int4 DEFAULT 0 NULL,
	CONSTRAINT produtos_pkey PRIMARY KEY (codigo, id_empresa)
);


-- public.produtos_opcional definição

-- Drop table

-- DROP TABLE public.produtos_opcional;

CREATE TABLE public.produtos_opcional (
	id_empresa int4 NOT NULL,
	id_material int4 NOT NULL,
	id_opcional int4 NOT NULL
);


-- public.restricoesvendas definição

-- Drop table

-- DROP TABLE public.restricoesvendas;

CREATE TABLE public.restricoesvendas (
	idempresa int4 NULL,
	idproduto int4 NULL,
	segundafeira bool DEFAULT false NULL,
	tercafeira bool DEFAULT false NULL,
	quartafeira bool DEFAULT false NULL,
	quintafeira bool DEFAULT false NULL,
	sextafeira bool DEFAULT false NULL,
	sabado bool DEFAULT false NULL,
	domingo bool DEFAULT false NULL
);


-- public.sincronizacao definição

-- Drop table

-- DROP TABLE public.sincronizacao;

CREATE TABLE public.sincronizacao (
	id int4 NOT NULL, -- ID de sincronizacao
	"data" timestamp NOT NULL, -- Data da sincronizacao
	id_empresa int4 NOT NULL -- ID da empresa
);

-- Column comments

COMMENT ON COLUMN public.sincronizacao.id IS 'ID de sincronizacao';
COMMENT ON COLUMN public.sincronizacao."data" IS 'Data da sincronizacao';
COMMENT ON COLUMN public.sincronizacao.id_empresa IS 'ID da empresa';


-- public.transferencia_imagens definição

-- Drop table

-- DROP TABLE public.transferencia_imagens;

CREATE TABLE public.transferencia_imagens (
	id serial4 NOT NULL,
	tipo varchar(10) NOT NULL,
	id_empresa int4 DEFAULT 1 NOT NULL,
	id_registro int4 NOT NULL
);


-- public.usuarios definição

-- Drop table

-- DROP TABLE public.usuarios;

CREATE TABLE public.usuarios (
	codigo int4 NOT NULL,
	nome varchar(30) NULL,
	senha varchar(60) NULL,
	email varchar(100) NULL,
	id_situacao int4 DEFAULT 4 NOT NULL,
	CONSTRAINT pk_usuarios PRIMARY KEY (codigo)
);


-- public.usuarios_empresa definição

-- Drop table

-- DROP TABLE public.usuarios_empresa;

CREATE TABLE public.usuarios_empresa (
	codigo_usuario int4 NOT NULL,
	id_empresa int4 NOT NULL,
	CONSTRAINT pk_usuarios_empresa PRIMARY KEY (codigo_usuario, id_empresa)
);


-- public.usuarios_permissoes definição

-- Drop table

-- DROP TABLE public.usuarios_permissoes;

CREATE TABLE public.usuarios_permissoes (
	codigo_usuario int4 NOT NULL,
	b_acesso_web bool DEFAULT false NULL,
	b_admin_web bool DEFAULT false NULL,
	id_empresa int4 DEFAULT 1 NOT NULL
);


-- public.venda definição

-- Drop table

-- DROP TABLE public.venda;

CREATE TABLE public.venda (
	id_venda int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	id_empresa int4 NOT NULL,
	id_situacao int4 NOT NULL,
	id_formapgto int4 NOT NULL,
	id_cliente int4 NOT NULL,
	totals_products numeric(15, 2) NULL,
	sub_total numeric(15, 2) NULL,
	taxa_entrega numeric(15, 2) NULL,
	troco numeric(15, 2) NULL,
	valor_receber numeric(15, 2) NULL,
	sales numeric(15, 2) NULL,
	data_pedido timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
	b_recebido_lecheff bool DEFAULT false NOT NULL,
	tipo_entrega varchar(2) DEFAULT 'D'::character varying NOT NULL,
	observacao varchar(200) NULL,
	CONSTRAINT pk_venda PRIMARY KEY (id_venda, id_empresa)
);


-- public.venda_endereco definição

-- Drop table

-- DROP TABLE public.venda_endereco;

CREATE TABLE public.venda_endereco (
	id_venda int4 NOT NULL,
	id_cliente int4 NOT NULL,
	id_bairro int4 NULL,
	cep varchar(14) NOT NULL,
	logradouro varchar(150) NOT NULL,
	numero varchar(30) NULL,
	complemento varchar(150) NULL,
	ponto_referencia varchar(150) NULL,
	bairro_desc varchar(100) NULL,
	CONSTRAINT venda_endereco_pkey PRIMARY KEY (id_venda, id_cliente)
);


-- public.vendaitemopcional definição

-- Drop table

-- DROP TABLE public.vendaitemopcional;

CREATE TABLE public.vendaitemopcional (
	id_venda int4 NOT NULL,
	id_empresa int4 NOT NULL,
	id_numero_item int4 NOT NULL,
	id_opcional int4 NOT NULL,
	gratis numeric(15, 4) DEFAULT 0 NOT NULL,
	valor numeric(15, 4) DEFAULT 0 NOT NULL,
	valorunitario numeric(15, 4) DEFAULT 0 NOT NULL,
	valortotal numeric(15, 4) DEFAULT 0 NOT NULL,
	quantidade numeric(15, 4) DEFAULT 0 NOT NULL,
	quantidade_replicar numeric(15, 4) DEFAULT 0 NOT NULL
);


-- public.vendamesa definição

-- Drop table

-- DROP TABLE public.vendamesa;

CREATE TABLE public.vendamesa (
	id_venda int4 NULL,
	id_empresa int4 NULL,
	id_situacao int4 NULL,
	totals_products numeric(15, 3) NULL,
	sub_total numeric(15, 3) NULL,
	sales numeric(15, 3) NULL,
	data_pedido timestamp NULL,
	b_recebido_lecheff bool DEFAULT false NULL,
	observacao varchar(300) NULL,
	numero_mesa int4 NULL,
	descricao_mesa varchar(20) NULL
);


-- public.vendamesaitem definição

-- Drop table

-- DROP TABLE public.vendamesaitem;

CREATE TABLE public.vendamesaitem (
	id_venda int4 NOT NULL,
	id_empresa int4 NOT NULL,
	id_product int4 NOT NULL,
	numero_item int4 NOT NULL,
	quantidade numeric(15, 4) DEFAULT 0 NOT NULL,
	valor_unit_product numeric(15, 4) DEFAULT 0 NOT NULL,
	totals_products numeric(15, 4) DEFAULT 0 NOT NULL,
	id_situacao int4 NULL,
	tamanho varchar(2) NULL,
	b_venda_tamanho bool DEFAULT false NULL,
	item_fracionado int4 NULL,
	observacao varchar(150) NULL,
	b_recebido_lecheff bool DEFAULT false NULL,
	utilizou_happy_hour bool DEFAULT false NULL,
	utilizou_promocao bool DEFAULT false NULL,
	CONSTRAINT pk_vendamesaitem PRIMARY KEY (id_venda, id_empresa, numero_item)
);


-- public.vendas_status_log definição

-- Drop table

-- DROP TABLE public.vendas_status_log;

CREATE TABLE public.vendas_status_log (
	id_venda int4 NOT NULL,
	id_empresa int4 DEFAULT 1 NOT NULL,
	id_situacao int4 NOT NULL,
	"data" timestamp NULL,
	CONSTRAINT pk_vendas_status_log PRIMARY KEY (id_venda, id_empresa, id_situacao)
);


-- public.bairro_ceps definição

-- Drop table

-- DROP TABLE public.bairro_ceps;

CREATE TABLE public.bairro_ceps (
	bai_001 int4 NOT NULL,
	emp_001 int4 NOT NULL,
	cep varchar(9) NOT NULL,
	logradouro varchar(125) NULL,
	id_cidade int4 NULL,
	cidade_desc varchar(75) NULL,
	uf_sigla varchar(2) NULL,
	CONSTRAINT pk_bairro_ceps PRIMARY KEY (bai_001, emp_001, cep),
	CONSTRAINT fk_bairro_ceps FOREIGN KEY (bai_001,emp_001) REFERENCES public.bairro(bai_001,emp_001) ON DELETE CASCADE
);


-- public.formapgto definição

-- Drop table

-- DROP TABLE public.formapgto;

CREATE TABLE public.formapgto (
	id int4 NOT NULL,
	id_empresa int4 NOT NULL,
	descricao varchar(50) NULL,
	id_situacao int4 NULL,
	b_venda_web bool DEFAULT false NULL,
	sfi_codigo int4 NULL,
	CONSTRAINT formapgto_pkey PRIMARY KEY (id, id_empresa),
	CONSTRAINT fk_formapgto_id FOREIGN KEY (id_empresa) REFERENCES public.empresas(id_empresa) ON DELETE CASCADE ON UPDATE CASCADE
);


-- public.promocao definição

-- Drop table

-- DROP TABLE public.promocao;

CREATE TABLE public.promocao (
	id_promocao int4 NOT NULL,
	id_empresa int4 NOT NULL,
	id_material int4 NOT NULL,
	tipo_desconto int4 DEFAULT 0 NOT NULL,
	segundafeira bool DEFAULT false NOT NULL,
	tercafeira bool DEFAULT false NOT NULL,
	quartafeira bool DEFAULT false NOT NULL,
	quintafeira bool DEFAULT false NOT NULL,
	sextafeira bool DEFAULT false NOT NULL,
	sabado bool DEFAULT false NOT NULL,
	domingo bool DEFAULT false NOT NULL,
	tipomesa bool DEFAULT false NOT NULL,
	tipodelivery bool DEFAULT false NOT NULL,
	tipocomanda bool DEFAULT false NOT NULL,
	descontosegundapadrao numeric(15, 3) DEFAULT 0 NULL,
	descontosegundatamanhop numeric(15, 3) DEFAULT 0 NULL,
	descontosegundatamanhom numeric(15, 3) DEFAULT 0 NULL,
	descontosegundatamanhog numeric(15, 3) DEFAULT 0 NULL,
	descontosegundatamanhogg numeric(15, 3) DEFAULT 0 NULL,
	descontosegundatamanhoextra numeric(15, 3) DEFAULT 0 NULL,
	desconto_ter_padrao numeric(15, 3) DEFAULT 0 NULL,
	desconto_ter_tam_p numeric(15, 3) DEFAULT 0 NULL,
	desconto_ter_tam_m numeric(15, 3) DEFAULT 0 NULL,
	desconto_ter_tam_g numeric(15, 3) DEFAULT 0 NULL,
	desconto_ter_tam_gg numeric(15, 3) DEFAULT 0 NULL,
	desconto_ter_tam_extra numeric(15, 3) DEFAULT 0 NULL,
	desconto_qua_padrao numeric(15, 3) DEFAULT 0 NULL,
	desconto_qua_tam_p numeric(15, 3) DEFAULT 0 NULL,
	desconto_qua_tam_m numeric(15, 3) DEFAULT 0 NULL,
	desconto_qua_tam_g numeric(15, 3) DEFAULT 0 NULL,
	desconto_qua_tam_gg numeric(15, 3) DEFAULT 0 NULL,
	desconto_qua_tam_extra numeric(15, 3) DEFAULT 0 NULL,
	desconto_qui_padrao numeric(15, 3) DEFAULT 0 NULL,
	desconto_qui_tam_p numeric(15, 3) DEFAULT 0 NULL,
	desconto_qui_tam_m numeric(15, 3) DEFAULT 0 NULL,
	desconto_qui_tam_g numeric(15, 3) DEFAULT 0 NULL,
	desconto_qui_tam_gg numeric(15, 3) DEFAULT 0 NULL,
	desconto_qui_tam_extra numeric(15, 3) DEFAULT 0 NULL,
	desconto_sex_padrao numeric(15, 3) DEFAULT 0 NULL,
	desconto_sex_tam_p numeric(15, 3) DEFAULT 0 NULL,
	desconto_sex_tam_m numeric(15, 3) DEFAULT 0 NULL,
	desconto_sex_tam_g numeric(15, 3) DEFAULT 0 NULL,
	desconto_sex_tam_gg numeric(15, 3) DEFAULT 0 NULL,
	desconto_sex_tam_extra numeric(15, 3) DEFAULT 0 NULL,
	desconto_sab_padrao numeric(15, 3) DEFAULT 0 NULL,
	desconto_sab_tam_p numeric(15, 3) DEFAULT 0 NULL,
	desconto_sab_tam_m numeric(15, 3) DEFAULT 0 NULL,
	desconto_sab_tam_g numeric(15, 3) DEFAULT 0 NULL,
	desconto_sab_tam_gg numeric(15, 3) DEFAULT 0 NULL,
	desconto_sab_tam_extra numeric(15, 3) DEFAULT 0 NULL,
	desconto_dom_padrao numeric(15, 3) DEFAULT 0 NULL,
	desconto_dom_tam_p numeric(15, 3) DEFAULT 0 NULL,
	desconto_dom_tam_m numeric(15, 3) DEFAULT 0 NULL,
	desconto_dom_tam_g numeric(15, 3) DEFAULT 0 NULL,
	desconto_dom_tam_gg numeric(15, 3) DEFAULT 0 NULL,
	desconto_dom_tam_extra numeric(15, 3) DEFAULT 0 NULL,
	CONSTRAINT pk_promocao PRIMARY KEY (id_promocao, id_empresa),
	CONSTRAINT fk_promocao_idmaterial FOREIGN KEY (id_material,id_empresa) REFERENCES public.produtos(codigo,id_empresa) ON DELETE CASCADE
);


-- public.vendaitem definição

-- Drop table

-- DROP TABLE public.vendaitem;

CREATE TABLE public.vendaitem (
	id_venda int4 NOT NULL,
	id_empresa int4 NOT NULL,
	id_product int4 NOT NULL,
	numero_item int4 NOT NULL,
	quantidade numeric(15, 4) DEFAULT 0 NOT NULL,
	valor_unit_product numeric(15, 4) DEFAULT 0 NOT NULL,
	totals_products numeric(15, 4) DEFAULT 0 NOT NULL,
	id_situacao int4 NULL,
	tamanho varchar(40) NULL,
	b_venda_tamanho bool DEFAULT false NULL,
	item_fracionado int4 NULL,
	observacao varchar(150) NULL,
	utilizou_happy_hour bool DEFAULT false NULL,
	CONSTRAINT pk_vendaitem PRIMARY KEY (id_venda, id_empresa, numero_item),
	CONSTRAINT fk_venda_item_empresa FOREIGN KEY (id_empresa) REFERENCES public.empresas(id_empresa) ON DELETE CASCADE ON UPDATE CASCADE
);



-- DROP FUNCTION public.is_atendimento_disponivel();

CREATE OR REPLACE FUNCTION public.is_atendimento_disponivel()
 RETURNS boolean
 LANGUAGE plpgsql
AS $function$
DECLARE
    atendimento_disponivel BOOLEAN := false;
    config configuracao_funcionamento%ROWTYPE;
    current_day_of_week INTEGER;
    current_local_time TIME;
BEGIN
    -- Obter o dia da semana atual (0 para domingo, 1 para segunda-feira, 2 para terça-feira, etc.)
    current_day_of_week := EXTRACT(DOW FROM CURRENT_DATE)::INTEGER;

    -- Obter o horário atual em 'America/Sao_Paulo'
    current_local_time := (SELECT Current_Time at time zone 'America/Sao_Paulo');

    -- Obter as configurações de atendimento
    SELECT * INTO config FROM configuracao_funcionamento LIMIT 1;

    -- Verificar se o atendimento está disponível no dia da semana atual
    CASE current_day_of_week
        WHEN 1 THEN
            atendimento_disponivel := config.dia_segunda AND
                current_local_time >= config.segunda_inicio_atendimento AND
                current_local_time <= config.segunda_fim_atendimento;
        WHEN 2 THEN
            atendimento_disponivel := config.dia_terca AND
                current_local_time >= config.terca_inicio_atendimento AND
                current_local_time <= config.terca_fim_atendimento;
        WHEN 3 THEN
            atendimento_disponivel := config.dia_quarta AND
                current_local_time >= config.quarta_inicio_atendimento AND
                current_local_time <= config.quarta_fim_atendimento;
        WHEN 4 THEN
            atendimento_disponivel := config.dia_quinta AND
                current_local_time >= config.quinta_inicio_atendimento AND
                current_local_time <= config.quinta_fim_atendimento;
        WHEN 5 THEN
            atendimento_disponivel := config.dia_sexta AND
                current_local_time >= config.sexta_inicio_atendimento AND
                current_local_time <= config.sexta_fim_atendimento;
        WHEN 6 THEN
            atendimento_disponivel := config.dia_sabado AND
                current_local_time >= config.sabado_inicio_atendimento AND
                current_local_time <= config.sabado_fim_atendimento;
        WHEN 0 THEN
            atendimento_disponivel := config.dia_domingo AND
                current_local_time >= config.domingo_inicio_atendimento AND
                current_local_time <= config.domingo_fim_atendimento;
    END CASE;

    RETURN atendimento_disponivel;
END;
$function$
;




	ALTER TABLE produtos
ALTER COLUMN observacao TYPE varchar(1200);




ALTER TABLE vendaitem 
ALTER COLUMN tamanho TYPE varchar(40);